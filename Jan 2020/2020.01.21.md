# 2019.01.21

## TCP-IP 이해하기, 서브넷 마스크 개념 이해하기

### IP 주소 체계를 이해하자.

* IP 주소는 특정한 TCP/IP 네트워크에 있는 호스트를 식별하는 32비트, 32자리 2진수 숫자이다.

* IP 주소는 보통 네 개의 숫자가 점으로 분리된 십진수 형식으로 표현한다. 각 분리된 부분을 옥텟이라고 부른다.

* 하나의 IP는 네트워크 부분 + 호스트 부분으로 나뉘어져 있다. 하나의 네트워크(이를 브로드캐스트 도메인이라고 부름)에 있는 IP끼리 통신하기 위해서는 네트워크 영역이 같고 호스트 IP는 서로 달라야 한다. 네트워크 영역이 다르면 라우터나 게이트웨이 같은 중개자가 필요하다.

* 예를 들면 다음과 같이 표기한다. IP 주소의 범위는 0 ~ 2^32승으로 약 42억 9천개 정도이다.

  | **172.**  | **16.**   | **254.**  | **1**    |
  | --------- | --------- | --------- | -------- |
  | 10101100. | 00010000. | 11111110. | 00000001 |

* IP 주소에는 5가지의 클래스가 있고, 보통 A/B/C라는 3가지 클래스를 바탕으로 언급한다.

![img](https://t1.daumcdn.net/cfile/tistory/99068D495BE8101D34)

* 구성이 이렇게 나뉘어진 이유는 과거에 IPv4 주소가 많이 필요해질 지 몰랐기 때문이리라.
  * A클래스는 **0sss ssss. hhhh hhhh. hhhh hhhh. hhhh hhhh** 로 구성되어 있을 때 첫 번째 인덱스의 값이 항상 0인 경우를 의미한다. dot를 기준으로 맨 처음 그룹이 네트워크 부분을 나타내며, 나머지 그룹은 모두 호스트 부분이다.
  * 따라서 10진수로 표기한 IP주소에서 1부터 126으로 시작하는 네트워크는 A클래스이다. 그리고 호스트 주소가 가질 수 있는 갯수는 (2^24) - 2 개이다. **(-2 이유는 모두가 1인경우 브로드캐스트 주소로 사용하고 모두 0인경우엔 네트워크 주소로 사용하기 때문입니다.)**
  * B클래스는 **10ss ssss .ssss ssss. hhhh hhhh. hhhh hhhh** 로 표현한다. 첫 번째 그룹의 값을 무조건 10으로 표기한다. 이 경우 네트워크 부분의 주소는 첫 두 그룹이다.
  * C클래스는 **110s ssss. ssss ssss. ssss ssss. hhhh hhhh** 로 표현한다. 첫 번째 그룹의 값을 무조건 110으로 표기한다. 이 경우 네트워크 부분의 주소는 첫 세 그룹이다.

### 서브네팅 개념을 이해하자.

* 서브네팅은 네트워크를 효율적으로 관리하기 위해 네트워크 부분과 호스트 부분을 다시 재분할 하는 것이다. 이 과정에서 부분망(subnet)이라는 개념을 도입하여 그룹으로 이미 나뉘어진 네트워크를 다시 분할한다. 효율성을 극대화하기 위한 고육지책인 것이다.
* 브로드캐스트 도메인이 너무 크면 네트워크 환경에서 패킷 전송이 느려지고 성능 저하를 발생시킨다. 따라서 네트워크를 쪼개서 통신 성능을 보장할 수 있어야 한다.
* 서브네팅은 네트워크 영역을 늘리고 호스트 영역을 줄이겠다는 뜻을 내포하고 있다.
* 서브네팅을 하기 위해서는 주어진 IP 주소를 네트워크 환경에 맞게 나누어주어야 하며, 이를 위해 사용하는 것이 바로 서브넷 마스크이다.

### 서브넷 마스크를 이해하자.

* 디폴트 서브넷 마스크는 IP 주소를 나누지 않는 경우에도 항상 필요하다. 네트워크를 나누지 않으면 디폴드 마스크를 사용한다.
  * 클래스 A는 255.0.0.0 // 클래스 B는 255.255.0.0 // 클래스 C는 255.255.255.0
* 네트워크 부분은 서브넷 마스크가 2진수로 1인 부분, 호스트 부분은 서브넷 마스크가 2진수로 0인 부분을 나타낸다.

```
1001 0110. 1001 0110. 0110 0100. 0000 0001 = 150.150.100.1 (IP주소)

1111 1111. 1111 1111. 1111 1111. 0000 0000 = 255.255.255.0 (C클래스 기본서브넷마스크)

1001 0110. 1001 0110. 0110 0100. 0000 0000 = 150.150.100.0 (서브넷네트워크)
```

* 위의 경우는 B 클래스에서 C 클래스 서브넷 마스크를 적용하여, 마치 C클래스 처럼 사용하겠다는 강력한 의지가 담겨있다.
* 다시 말해 B클래스에 의해서 150.150 까지가 네트워크 영역이고 나머지 3,4번째 옥태드가 호스트 영역인데, C클래스 기본 서브넷마스크인 255.255.255.0을 씌우면서 150.150.100까지 네트워크영역이 되고 4번째 옥태드만 호스트 IP를 배정할 수 있게 만든 것이다.

```
11001001 11011110 00000101 00000000 = 201.222.5.0 (IP 주소)

11111111 11111111 11111111 *11111*^000^ = 255.255.255.248 (서브넷마스크)

-1 11111111 11111111 11111111 (기본 C클래스가 가질 수 있는 네트워크 영역)

-2 *11111* (사용자 지정한 네트워크영역)

-3 ^000^ (사용자가 지정한 호스트영역)
```

* ```-2``` 부분이 바로 서브넷네트워크가 가질 수 있는 범위이다.00000 ~ 11111 (2^5) 까지 계속 바꿔 넣으면 32개의 서브넷네트워크로 쪼갤 수 있다. 
* 각 서브넷마스크가 가질 수 있는 호스트 IP 갯수는 ```-3``` 부분이다. 000 ~ 111 (2^3-2) 까지 계속 바꿔 넣으면 8개를 가질 수 있다. 여기에서 네트워크 주소와 브로드캐스트 기본 주소 2개를 빼면 총 6개를 가질 수 있다.
* 서브넷마스크는 A클래스, B클래스, C클래스의 기본 서브넷마스크에서 가질 수 있는 네트워크영역과 호스트영역을 더 쪼개서 더 효율적으로 서브네팅하는 것이다. 
* 따라서 C클래스(3옥테드까지만 네트워크로 사용함) 이상으로 4옥테드 영역에 5자리 2진수를 네트워크 영역으로 확대한 후, 호스트 영역을 3자리 2진수를 할당함으로써 기본 서브넷마스크로 커버할 수 없었던 서브네팅을 구현할 수 있게 되는 것이다.