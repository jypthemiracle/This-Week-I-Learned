# 넥스트스텝 ATDD 강의 2회차 2020-07-10

## API 설계 시

* RESTful에 집착하지 마라.
* Resources: HTML, JSON 모두 '날라오는 정보' 가 리소스라고 일컬을 수 있다. 대신, 약속과 명시를 꼭 하자.
  * 리소스의 네이밍에 집중해야 한다. 커뮤니케이션 비용을 줄일 수 있다.
* Document: 단수개의 리소스를 표현
* Collection: 복수개의 리소스를 표현
* Store: 클라이언트가 관리하는 리소스
  * 식별자가 있으면 Document
  * 식별자가 있으면 Store
* Controller: 절차라는 개념의 리소스이다. 동사를 활용한다.
* 중복 제거와 메서드 분리
* 어노테이션을 활용한 CRUD 추상화: Cucumber, JBehave
  * 이것이 BDD구나!
* 인수 테스트의 픽스쳐 관리

## 인수 테스트 어떻게 제작할까?

* API 기준으로 인수 테스트를 제작한다.
  * 변경에 유연하게 관리할 수 있다.
  * 비즈니스 규칙을 명확히 드러나도록 시나리오를 작성해본다.
* 인수 테스트는 시간과 비용이 많이 든다.
  * 핵심 로직만 인수 테스트를 작성한다.
  * 부수 로직은 단위 테스트를 작성한다.
* 외부 서비스와 연동하는 것도 인수 테스트의 중요한 요소이다.

## 인수 테스트 이후 TDD 흐름

* 컨트롤러부터 시작
* 컨트롤러 테스트에서 행위를 수행하는 서비스의 Mock을 호출해서 실제로 메소드가 작동하는지 verify한다.
* 서비스에 대한 목 객체를 만들고, 해당 객체를 껍데기만 만들어준다.
* Outside In: 상호작용을 고려
* Inside Out: 전통적인 방법
* ATDD는 BDD
  * given, when, then
* 아는 것에서 모르는 것으로 접근한다. (the direction of known-to-unknown)

* 테스트 대상으로 본다면 그것 자체가 단위!
* 통합과 고립
  * 통합: 협력 객체를 생성함
  * 고립: Mock 객체를 활용함
  * 어떤 것이 더 좋은가? 상황에 따라 다르다. 해 보면서 파악한다.
    * 외부 라이브러리를 사용하는 경우 실제 객체를 사용한다. 외부 라이브러리의 작동을 완벽하게 이해하지 못할거다.
* Test Double
  * Stubbing
    * MockitoExtension: ```@Mock```
    * SpringExtension: ```@MockBean```
* 통합 테스트
  * 데이터베이스 관련 빈들만 로드하게 할 수 있다.
    * ```DataJdbcTest```
    * ```JpaTest```
* 처음 쓰는 라이브러리에 대해 학습할 때 테스트를 해본다.
  * 내가 이해하는 대로 작동하는 지 확인해보기 위해서 학습 테스트를 진행한다.
* 테스트는 가볍게 가야 한다. 굳이 스프링 컨텍스트를 띄워야 하나?

